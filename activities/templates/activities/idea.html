{% extends "activities/base.html" %}
{% load static %}

{% block title %}ã‚¢ã‚¤ãƒ‡ã‚¢{% endblock %}
{% block page_title %}ã‚¢ã‚¤ãƒ‡ã‚¢{% endblock %}
{% block hamburger_title %}ã‚¢ã‚¤ãƒ‡ã‚¢{% endblock %}

{% block content %}
<section class="idea-page">

    <h2 class="idea-title">ã¿ã‚“ãªã®å¥åº·ã‚¢ã‚¤ãƒ‡ã‚¢</h2>

    {# ===== æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  ===== #}
    {% if user.is_authenticated %}
    <form method="post" class="idea-post-form" enctype="multipart/form-data">
        {% csrf_token %}
        <textarea
            name="content"
            class="idea-textarea"
            placeholder="ä»Šã®å¥åº·ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’æŠ•ç¨¿"
            required
        ></textarea>
        <input type="file" name="image" accept="image/*" class="idea-image-input">
        <button type="submit" class="idea-post-button">æŠ•ç¨¿</button>
    </form>
    {% else %}
        <p>æŠ•ç¨¿ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
    {% endif %}

    <div class="idea-list">

        {# ===== ã‚¢ã‚¤ãƒ‡ã‚¢ä¸€è¦§ ===== #}
        {% for idea in ideas %}
        <article class="idea-card">

            <div class="idea-header">
                <div class="idea-user">
                    <div class="user-icon"></div>
                    <div>
                        <p class="user-name">{{ idea.user.username }}</p>
                        <p class="idea-date">{{ idea.created_at|date:"n/j H:i" }}</p>
                    </div>
                </div>
                {% if idea.user == user %}
                    <form method="post" action="{% url 'delete_idea' idea.id %}" class="delete-idea-form">
                        {% csrf_token %}
                        <button type="submit" class="delete-idea-button">Ã—</button>
                    </form>
                {% endif %}
            </div>

            <div class="idea-body">
                <div class="idea-text">
                    <p class="idea-main">{{ idea.content }}</p>
                </div>
                {% if idea.image %}
                <div class="idea-image">
                    <img src="{{ idea.image.url }}" alt="Idea Image" style="max-width: 100%; height: auto; border-radius: 8px;">
                </div>
                {% endif %}
            </div>

            <div class="idea-footer">
                {# ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ â™¡ ğŸ‘ ğŸ˜¢ #}
                <form method="post" action="{% url 'react_idea' idea.id 'heart' %}" class="reaction-form">
                    {% csrf_token %}
                    <button type="submit" class="reaction-button">â¤ï¸ {{ idea.reaction_counts.heart|default:0 }}</button>
                </form>
                <form method="post" action="{% url 'react_idea' idea.id 'like' %}" class="reaction-form">
                    {% csrf_token %}
                    <button type="submit" class="reaction-button">ğŸ‘ {{ idea.reaction_counts.like|default:0 }}</button>
                </form>
                <form method="post" action="{% url 'react_idea' idea.id 'sad' %}" class="reaction-form">
                    {% csrf_token %}
                    <button type="submit" class="reaction-button">ğŸ˜¢ {{ idea.reaction_counts.sad|default:0 }}</button>
                </form>
            </div>

        </article>
        {% empty %}
            <p>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        {% endfor %}

    </div>

</section>
{% endblock %}
